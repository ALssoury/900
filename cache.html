<html>
  <head>
    <meta charset="utf-8">
    <title>ALSSOURY STATION HOST Jailbreak</title>
    <style>
      body {
        background:url('alssoury_1ogo.jpg');
        background-color: #252526;
        color: #cccccc;
        font-family: "Segoe UI", Tahoma, sans-serif;
        text-align: center;
      }
      h2 {
        margin-bottom: 20px;
      }
      #console {
        font-family: monospace;
        background-color: #1e1e1e;
        color: #cccccc;
        border: 1px solid #3c3c3c;
        padding: 12px;
        border-radius: 6px;
        margin-top: 20px;
        text-align: left;
      }
      #jailbreakBtn {
        margin-top: 20px;
        padding: 12px 24px;
        font-size: 18px;
        font-weight: bold;
        border: none;
        border-radius: 6px;
        background: #555555;
        color: #aaaaaa;
        cursor: not-allowed;
        opacity: 0.7;
        box-shadow: none;
      }
      footer {
        margin-top: 30px;
        font-size: 14px;
        color: #888;
      }
    </style>
  </head>
  <body>
    <h1>PS4IDEA HOST Jailbreak</h1>
    <h2>Preparing Cache...</h2>
    <div id="content-container">
      <button id="jailbreakBtn" disabled>Loading...</button>
    </div>
    <pre id="console"></pre>
    <footer>
       <h1>  THIS HOST FROM PS4IDEA
        <h2>   SPICIAL THANKS <strong>Feyzee</strong>
    </footer>
  </body>
  <script>
    // === بدء منطق Service Worker ===

    // إعدادات التاريخ لتجنب مشاكل التخزين المؤقت للمتصفح
    history.replaceState(null, null, 'index.html');
    var histlength = history.length;
    history.go(-histlength);

    // أداة تسجيل الرسائل (Logging utility)
    const outputConsole = document.getElementById("console");
    window.log = (msg, color = "#cccccc") => { 
        // نستخدم innerHTML لإضافة الألوان في هذا الملف
        outputConsole.innerHTML += `<span style="color:${color}">${msg}</span><br>`;
    };

    document.addEventListener('DOMContentLoaded', () => {
        outputConsole.textContent = ""; // مسح السجل
        window.log("Service Worker Registration initiating...");
        window.log("Please wait, this may take a few seconds.");

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(registration => {
                    window.log(`[SUCCESS] Service Worker registered scope: ${registration.scope}`, "green");
                    
                    // الانتظار حتى يتم تثبيت العامل (Service Worker) بالكامل
                    if (registration.installing) {
                        window.log("[INFO] Service Worker is installing...");
                        registration.installing.addEventListener('statechange', function(event) {
                            if (event.target.state === 'installed' || event.target.state === 'activated') {
                                DisplayCacheProgress();
                            }
                        });
                    } else if (registration.active) {
                        // إذا كان نشطاً بالفعل، هذا يعني أنه جاهز
                        DisplayCacheProgress();
                    }
                })
                .catch(error => {
                    window.log("[ERROR] Service Worker registration failed: " + error, "red");
                });
        } else {
            window.log("[WARNING] Service Worker not supported by the browser.", "yellow");
        }
    });

    // عند اكتمال عملية الكاش
    function DisplayCacheProgress() {
      window.log(" ");
      window.log("[SUCCESS] Cache installed successfully.", "green");
      window.log("Page will reload in 3 seconds...");
      // التأخير لعرض رسالة النجاح قبل التنقل
      setTimeout(function() { window.log("Reloading...", "yellow"); }, 2000);
      // التنقل إلى index.html لتحميل الاستغلال من الكاش
      setTimeout(function() { location.href = 'index.html'; }, 3000);
    }
    
    // === نهاية منطق Service Worker ===
  </script>
</html>